Options +SymLinksIfOwnerMatch -MultiViews
<IfModule mod_rewrite.c>
RewriteEngine On

#If your website is installed in a subfolder, change the line below to reflect the path to the subfolder.
#e.g. for http://www.example.com/subdomain1/subdomain2/ make it RewriteBase /subdomain1/subdomain2
RewriteBase /

#If you wish to use a custom 404 page, place a file named 404.php in your website's root and uncomment the line below.
#If your website is installed in a subfolder, change the line below to reflect the path to the subfolder.
#e.g. for http://www.example.com/subdomain1/subdomain2/ make it ErrorDocument 404 /subdomain1/subdomain2/404.php
#ErrorDocument 404 /404.php

#If your site begins with 'www', uncomment the following two lines
#RewriteCond %{HTTP_HOST} !^www\.
#RewriteRule ^(.*)$ http://www.%{HTTP_HOST}/$1 [R=301,L]


#DO NOT EDIT BELOW THIS


RewriteRule ^users/index.php$ "users/" [R=301,L,QSA]
RewriteRule ^index.php$ "" [R=301,L,QSA]

RewriteCond %{REQUEST_FILENAME} -d [OR]
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule . - [L]

#users/lost-password.php
RewriteRule ^users/lost-password$ "$0/" [R=301,L,QSA]
RewriteRule ^users/lost-password/$ users/lost-password.php [L,QSA]
RewriteRule ^users/lost-password/[^\.\/]*?([0-9]+)$ users/lost-password.php?p=$1 [L,QSA]
RewriteRule ^users/lost-password/([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ users/lost-password.php?d=$1$2$3 [L,QSA]
RewriteRule ^users/lost-password/[^\.]*?([^/\.]*)/$ users/lost-password.php?fname=$1 [L,QSA]
RewriteRule ^users/lost-password/[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]

#users/login.php
RewriteRule ^users/login$ "$0/" [R=301,L,QSA]
RewriteRule ^users/login/$ users/login.php [L,QSA]
RewriteRule ^users/login/[^\.\/]*?([0-9]+)$ users/login.php?p=$1 [L,QSA]
RewriteRule ^users/login/([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ users/login.php?d=$1$2$3 [L,QSA]
RewriteRule ^users/login/[^\.]*?([^/\.]*)/$ users/login.php?fname=$1 [L,QSA]
RewriteRule ^users/login/[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]

#users/index.php
RewriteRule ^users/[^\.\/]*?([0-9]+)$ users/?p=$1 [L,QSA]
RewriteRule ^users/([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ users/?d=$1$2$3 [L,QSA]
RewriteRule ^users/[^\.]*?([^/\.]*)/$ users/?fname=$1 [L,QSA]
RewriteRule ^users/[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]

#tag.php
RewriteRule ^tag$ "$0/" [R=301,L,QSA]
RewriteRule ^tag/$ tag.php [L,QSA]
RewriteRule ^tag/[^\.\/]*?([0-9]+)$ tag.php?p=$1 [L,QSA]
RewriteRule ^tag/([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ tag.php?d=$1$2$3 [L,QSA]
RewriteRule ^tag/[^\.]*?([^/\.]*)/$ tag.php?fname=$1 [L,QSA]
RewriteRule ^tag/[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]

#sitemap.php
RewriteRule ^sitemap$ "$0/" [R=301,L,QSA]
RewriteRule ^sitemap/$ sitemap.php [L,QSA]
RewriteRule ^sitemap/[^\.\/]*?([0-9]+)$ sitemap.php?p=$1 [L,QSA]
RewriteRule ^sitemap/([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ sitemap.php?d=$1$2$3 [L,QSA]
RewriteRule ^sitemap/[^\.]*?([^/\.]*)/$ sitemap.php?fname=$1 [L,QSA]
RewriteRule ^sitemap/[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]

#search.php
RewriteRule ^search$ "$0/" [R=301,L,QSA]
RewriteRule ^search/$ search.php [L,QSA]
RewriteRule ^search/[^\.\/]*?([0-9]+)$ search.php?p=$1 [L,QSA]
RewriteRule ^search/([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ search.php?d=$1$2$3 [L,QSA]
RewriteRule ^search/[^\.]*?([^/\.]*)/$ search.php?fname=$1 [L,QSA]
RewriteRule ^search/[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]

#login.php
RewriteRule ^login$ "$0/" [R=301,L,QSA]
RewriteRule ^login/$ login.php [L,QSA]
RewriteRule ^login/[^\.\/]*?([0-9]+)$ login.php?p=$1 [L,QSA]
RewriteRule ^login/([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ login.php?d=$1$2$3 [L,QSA]
RewriteRule ^login/[^\.]*?([^/\.]*)/$ login.php?fname=$1 [L,QSA]
RewriteRule ^login/[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]

#feed.php
RewriteRule ^feed$ "$0/" [R=301,L,QSA]
RewriteRule ^feed/$ feed.php [L,QSA]
RewriteRule ^feed/[^\.\/]*?([0-9]+)$ feed.php?p=$1 [L,QSA]
RewriteRule ^feed/([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ feed.php?d=$1$2$3 [L,QSA]
RewriteRule ^feed/[^\.]*?([^/\.]*)/$ feed.php?fname=$1 [L,QSA]
RewriteRule ^feed/[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]

#404.php
RewriteRule ^404$ "$0/" [R=301,L,QSA]
RewriteRule ^404/$ 404.php [L,QSA]
RewriteRule ^404/[^\.\/]*?([0-9]+)$ 404.php?p=$1 [L,QSA]
RewriteRule ^404/([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ 404.php?d=$1$2$3 [L,QSA]
RewriteRule ^404/[^\.]*?([^/\.]*)/$ 404.php?fname=$1 [L,QSA]
RewriteRule ^404/[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]

#index.php
RewriteRule ^[^\.\/]*?([0-9]+)$ ?p=$1 [L,QSA]
RewriteRule ^([1-2]\d{3})/(?:(0[1-9]|1[0-2])/(?:(0[1-9]|1[0-9]|2[0-9]|3[0-1])/)?)?$ ?d=$1$2$3 [L,QSA]
RewriteRule ^[^\.]*?([^/\.]*)/$ ?fname=$1 [L,QSA]
RewriteRule ^\w[^\.]*?([^/\.]*)$ "$0/" [R=301,L,QSA]
